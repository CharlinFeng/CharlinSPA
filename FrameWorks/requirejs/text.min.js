define(["module"],function(e){var p,j,i,d,q,g=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c=typeof location!=="undefined"&&location.href,f=c&&location.protocol&&location.protocol.replace(/\:/,""),h=c&&location.hostname,a=c&&(location.port||undefined),m={},k=(e.config&&e.config())||{};function b(s,r){return s===undefined||s===""?r:s}function n(s,u,r,t){if(u===t){return true}else{if(s===r){if(s==="http"){return b(u,"80")===b(t,"80")}else{if(s==="https"){return b(u,"443")===b(t,"443")}}}}return false}p={version:"2.0.15",strip:function(r){if(r){r=r.replace(o,"");var s=r.match(l);if(s){r=s[1]}}else{r=""}return r},jsEscape:function(r){return r.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:k.createXhr||function(){var u,r,s;if(typeof XMLHttpRequest!=="undefined"){return new XMLHttpRequest()}else{if(typeof ActiveXObject!=="undefined"){for(r=0;r<3;r+=1){s=g[r];try{u=new ActiveXObject(s)}catch(t){}if(u){g=[s];break}}}}return u},parseName:function(t){var x,w,r,v=false,s=t.lastIndexOf("."),u=t.indexOf("./")===0||t.indexOf("../")===0;if(s!==-1&&(!u||s>1)){x=t.substring(0,s);w=t.substring(s+1)}else{x=t}r=w||x;s=r.indexOf("!");if(s!==-1){v=r.substring(s+1)==="strip";r=r.substring(0,s);if(w){w=r}else{x=r}}return{moduleName:x,ext:w,strip:v}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(u,y,s,r){var w,x,v,t=p.xdRegExp.exec(u);if(!t){return true}w=t[2];x=t[3];x=x.split(":");v=x[1];x=x[0];return(!w||w===y)&&(!x||x.toLowerCase()===s.toLowerCase())&&((!v&&!x)||n(w,v,y,r))},finishLoad:function(r,t,u,s){u=t?p.strip(u):u;if(k.isBuild){m[r]=u}s(u)},load:function(v,x,w,u){if(u&&u.isBuild&&!u.inlineText){w();return}k.isBuild=u&&u.isBuild;var s=p.parseName(v),y=s.moduleName+(s.ext?"."+s.ext:""),t=x.toUrl(y),r=(k.useXhr)||p.useXhr;if(t.indexOf("empty:")===0){w();return}if(!c||r(t,f,h,a)){p.get(t,function(z){p.finishLoad(v,s.strip,z,w)},function(z){if(w.error){w.error(z)}})}else{x([y],function(z){p.finishLoad(s.moduleName+"."+s.ext,s.strip,z,w)})}},write:function(v,s,t,r){if(m.hasOwnProperty(s)){var u=p.jsEscape(m[s]);t.asModule(v+"!"+s,"define(function () { return '"+u+"';});\n")}},writeFile:function(w,s,y,z,t){var x=p.parseName(s),r=x.ext?"."+x.ext:"",u=x.moduleName+r,v=y.toUrl(x.moduleName+r)+".js";p.load(u,y,function(A){var B=function(C){return z(v,C)};B.asModule=function(C,D){return z.asModule(C,v,D)};p.write(w,u,B,t)},t)}};if(k.env==="node"||(!k.env&&typeof process!=="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"])){j=require.nodeRequire("fs");p.get=function(s,v,r){try{var t=j.readFileSync(s,"utf8");if(t[0]==="\uFEFF"){t=t.substring(1)}v(t)}catch(u){if(r){r(u)}}}}else{if(k.env==="xhr"||(!k.env&&p.createXhr())){p.get=function(s,w,r,u){var t=p.createXhr(),v;t.open("GET",s,true);if(u){for(v in u){if(u.hasOwnProperty(v)){t.setRequestHeader(v.toLowerCase(),u[v])}}}if(k.onXhr){k.onXhr(t,s)}t.onreadystatechange=function(y){var x,z;if(t.readyState===4){x=t.status||0;if(x>399&&x<600){z=new Error(s+" HTTP status: "+x);z.xhr=t;if(r){r(z)}}else{w(t.responseText)}if(k.onXhrComplete){k.onXhrComplete(t,s)}}};t.send(null)}}else{if(k.env==="rhino"||(!k.env&&typeof Packages!=="undefined"&&typeof java!=="undefined")){p.get=function(r,y){var t,z,s="utf-8",u=new java.io.File(r),v=java.lang.System.getProperty("line.separator"),x=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(u),s)),w="";try{t=new java.lang.StringBuffer();z=x.readLine();if(z&&z.length()&&z.charAt(0)===65279){z=z.substring(1)}if(z!==null){t.append(z)}while((z=x.readLine())!==null){t.append(v);t.append(z)}w=String(t.toString())}finally{x.close()}y(w)}}else{if(k.env==="xpconnect"||(!k.env&&typeof Components!=="undefined"&&Components.classes&&Components.interfaces)){i=Components.classes;d=Components.interfaces;Components.utils["import"]("resource://gre/modules/FileUtils.jsm");q=("@mozilla.org/windows-registry-key;1" in i);p.get=function(t,x){var s,u,v,r={};if(q){t=t.replace(/\//g,"\\")}v=new FileUtils.File(t);try{s=i["@mozilla.org/network/file-input-stream;1"].createInstance(d.nsIFileInputStream);s.init(v,1,0,false);u=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(d.nsIConverterInputStream);u.init(s,"utf-8",s.available(),d.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);u.readString(s.available(),r);u.close();s.close();x(r.value)}catch(w){throw new Error((v&&v.path||"")+": "+w)}}}}}}return p});
